[
  {
    "name": "app",
    "image": "${app_image_url}",
    "essential": true,
    "ulimits": [
      {
        "name": "nofile",
        "softLimit": 1024000,
        "hardLimit": 1024000
      }
    ],
    "secrets": [
      {
        "name": "DB_HOSTNAME",
        "valueFrom": "${db_hostname_arn}"
      },
      {
        "name": "DB_PASSWORD",
        "valueFrom": "${db_password_arn}"
      },
      {
        "name": "DB_USERNAME",
        "valueFrom": "${db_username_arn}"
      },
      {
        "name": "DB_NAME",
        "valueFrom": "${db_name_arn}"
      }
     ],
      "environment": [
      {
        "name": "REGION",
        "value": "${aws_region}"
      },
      {
        "name": "UPLOAD_S3_BUCKET_NAME",
        "value": "${upload_images_bucket_name}"
      },
      {
        "name": "LGTM_IMAGES_CDN_DOMAIN",
        "value": "${lgtm_images_cdn_domain}"
      }
    ],
    "logConfiguration": {
      "logDriver": "awslogs",
      "options": {
        "awslogs-group": "${app_aws_logs_group}",
        "awslogs-region": "${aws_region}",
        "awslogs-stream-prefix": "ecs"
      }
    }
  },
  {
    "name": "nginx",
    "image": "${nginx_image_url}",
    "essential": true,
    "ulimits": [
      {
        "name": "nofile",
        "softLimit": 1024000,
        "hardLimit": 1024000
      }
    ],
    "portMappings": [
      {
        "containerPort": 80,
        "hostPort": 80,
        "protocol": "tcp"
      }
    ],
    "environment": [
      {
        "name": "BACKEND_HOST",
        "value": "127.0.0.1"
      },
      {
        "name": "PORT",
        "value": "80"
      }
    ],
    "logConfiguration": {
      "logDriver": "awslogs",
      "options": {
        "awslogs-group": "${nginx_aws_logs_group}",
        "awslogs-region": "${aws_region}",
        "awslogs-stream-prefix": "ecs"
      }
    }
  }
]
